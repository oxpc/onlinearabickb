<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phonetic Arabic Virtual Keyboard</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --key-bg: #ffffff;
            --key-hover: #e4e6eb;
            --key-active: #d8dadf;
            --primary: #1877f2;
            --text-main: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 1.5rem;
            color: var(--text-main);
            margin: 0;
        }

        /* Toggle Switch */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Text Area */
        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            font-size: 24px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            margin-bottom: 20px;
            font-family: 'Times New Roman', serif; /* Serif looks better for Arabic */
            box-sizing: border-box;
            outline: none;
        }
        
        textarea:focus {
            border-color: var(--primary);
        }

        /* Keyboard Layout */
        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 6px;
            user-select: none;
            background: #d1d5db;
            padding: 10px;
            border-radius: 8px;
        }

        .row {
            display: flex;
            justify-content: center;
            gap: 6px;
        }

        .key {
            background: var(--key-bg);
            border: 1px solid #ccc;
            border-radius: 5px;
            color: var(--text-main);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 50px;
            min-width: 45px;
            flex: 1;
            position: relative;
            transition: all 0.1s;
            box-shadow: 0 2px 0 #888;
        }

        .key:active, .key.active {
            transform: translateY(2px);
            box-shadow: none;
            background-color: var(--key-active);
        }

        .key span.main { font-size: 1.2rem; font-weight: bold; }
        .key span.sub { font-size: 0.7rem; color: #888; position: absolute; top: 2px; right: 4px; }

        .key-special { flex: 1.5; background: #e0e0e0; font-size: 0.9rem; }
        .key-space { flex: 6; }
        .key-shift { flex: 1.8; }
        
        .legend {
            margin-top: 15px;
            font-size: 0.85rem;
            color: #666;
            text-align: center;
        }

        /* RTL specific styling */
        textarea[dir="rtl"] {
            text-align: right;
        }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Phonetic Arabic Keyboard</h1>
        <div class="toggle-container">
            <span>Phonetic Mode</span>
            <label class="switch">
                <input type="checkbox" id="modeToggle" checked>
                <span class="slider"></span>
            </label>
        </div>
    </div>

    <textarea id="output" dir="rtl" placeholder="Type here (e.g., 's' for 'س', '7' for 'ح')..."></textarea>

    <div class="keyboard" id="keyboard">
        <!-- Generated by JS -->
    </div>

    <div class="legend">
        Typing Tip: Use <b>2</b> for ء, <b>3</b> for ع, <b>5</b> for خ, <b>7</b> for ح, <b>Shift+S</b> for ص, <b>Shift+D</b> for ض, <b>Shift+T</b> for ط.
    </div>
</div>

<script>
    /**
     * Phonetic Mapping Logic (Franco-Arabic style)
     * Maps physical keys (based on QWERTY standard) to Arabic characters.
     */
    const mappings = {
        // Numbers & Symbols Row
        '`': { default: 'ذ', shift: 'ّ' },
        '1': { default: '١', shift: '!' },
        '2': { default: '٢', shift: 'ء' }, // 2 often mapped to hamza in chat
        '3': { default: '٣', shift: 'ع' }, // 3 is ain
        '4': { default: '٤', shift: 'ش' }, // 4 sometimes sheem
        '5': { default: '٥', shift: 'خ' }, // 5 represents kha
        '6': { default: '٦', shift: 'ط' }, // 6 represents Ta
        '7': { default: '٧', shift: 'ح' }, // 7 represents Ha
        '8': { default: '٨', shift: 'ق' }, // 8 sometimes qaf
        '9': { default: '٩', shift: 'ص' }, // 9 sometimes sad
        '0': { default: '٠', shift: '(' },
        '-': { default: '-', shift: '_' },
        '=': { default: '=', shift: '+' },

        // Row 1
        'q': { default: 'ق', shift: 'ض' },
        'w': { default: 'و', shift: 'ؤ' },
        'e': { default: 'ع', shift: 'إ' }, // Phonetic: E -> Ain
        'r': { default: 'ر', shift: 'R' }, // Usually just Ra
        't': { default: 'ت', shift: 'ط' }, // Shift T -> Ta (heavy)
        'y': { default: 'ي', shift: 'ى' },
        'u': { default: 'ة', shift: 'ُ' }, // u for marbuta often
        'i': { default: 'ي', shift: 'إ' },
        'o': { default: 'ه', shift: 'O' }, // o for ha
        'p': { default: 'ة', shift: 'P' },
        '[': { default: 'ج', shift: '{' },
        ']': { default: 'د', shift: '}' },
        '\\': { default: '\\', shift: '|' },

        // Row 2
        'a': { default: 'ا', shift: 'أ' },
        's': { default: 'س', shift: 'ص' }, // Shift S -> Sad
        'd': { default: 'د', shift: 'ض' }, // Shift D -> Dad
        'f': { default: 'ف', shift: 'F' },
        'g': { default: 'ج', shift: 'غ' }, // Phonetic g -> jeem, Shift G -> ghain
        'h': { default: 'ه', shift: 'ح' }, // h -> ha, shift h -> Ha (7)
        'j': { default: 'ج', shift: 'J' },
        'k': { default: 'ك', shift: 'K' },
        'l': { default: 'ل', shift: 'لا' },
        ';': { default: '؛', shift: ':' },
        '\'': { default: '،', shift: '"' },

        // Row 3
        'z': { default: 'ز', shift: 'ظ' }, // Shift Z -> Dha
        'x': { default: 'خ', shift: 'X' }, // x often kha
        'c': { default: 'ث', shift: 'C' }, // c often tha
        'v': { default: 'ظ', shift: 'V' },
        'b': { default: 'ب', shift: 'B' },
        'n': { default: 'ن', shift: 'N' },
        'm': { default: 'م', shift: 'M' },
        ',': { default: 'و', shift: '<' },
        '.': { default: 'ز', shift: '>' },
        '/': { default: 'ظ', shift: '?' }
    };

    // Mapping fallback for physical key codes (KeyboardEvent.code) to standard chars
    // This allows us to map by position regardless of language setting, but here we assume QWERTY input.
    const codeToChar = {
        'Backquote': '`', 'Digit1': '1', 'Digit2': '2', 'Digit3': '3', 'Digit4': '4', 'Digit5': '5', 'Digit6': '6', 'Digit7': '7', 'Digit8': '8', 'Digit9': '9', 'Digit0': '0', 'Minus': '-', 'Equal': '=',
        'KeyQ': 'q', 'KeyW': 'w', 'KeyE': 'e', 'KeyR': 'r', 'KeyT': 't', 'KeyY': 'y', 'KeyU': 'u', 'KeyI': 'i', 'KeyO': 'o', 'KeyP': 'p', 'BracketLeft': '[', 'BracketRight': ']', 'Backslash': '\\',
        'KeyA': 'a', 'KeyS': 's', 'KeyD': 'd', 'KeyF': 'f', 'KeyG': 'g', 'KeyH': 'h', 'KeyJ': 'j', 'KeyK': 'k', 'KeyL': 'l', 'Semicolon': ';', 'Quote': '\'',
        'KeyZ': 'z', 'KeyX': 'x', 'KeyC': 'c', 'KeyV': 'v', 'KeyB': 'b', 'KeyN': 'n', 'KeyM': 'm', 'Comma': ',', 'Period': '.', 'Slash': '/'
    };

    // Keyboard Structure
    const layout = [
        ['`', '1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '-', '=', 'Backspace'],
        ['Tab', 'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', '[', ']', '\\'],
        ['Caps', 'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', ';', '\'', 'Enter'],
        ['Shift', 'z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/', 'Shift'],
        ['Space']
    ];

    const textarea = document.getElementById('output');
    const keyboardContainer = document.getElementById('keyboard');
    const toggle = document.getElementById('modeToggle');
    
    let isShifted = false;
    let isCaps = false;

    // --- Core Functions ---

    function getChar(baseKey, shift) {
        if (!mappings[baseKey]) return baseKey; // No mapping defined
        
        // Handle logic: Shift overrides default
        if (shift) {
            return mappings[baseKey].shift || mappings[baseKey].default;
        }
        return mappings[baseKey].default;
    }

    function insertAtCursor(text) {
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const val = textarea.value;
        textarea.value = val.substring(0, start) + text + val.substring(end);
        textarea.selectionStart = textarea.selectionEnd = start + text.length;
        textarea.focus();
    }

    function handleBackspace() {
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const val = textarea.value;
        if (start === end && start > 0) {
            textarea.value = val.substring(0, start - 1) + val.substring(end);
            textarea.selectionStart = textarea.selectionEnd = start - 1;
        } else if (start !== end) {
            textarea.value = val.substring(0, start) + val.substring(end);
            textarea.selectionStart = textarea.selectionEnd = start;
        }
        textarea.focus();
    }

    // --- Rendering ---

    function renderKeyboard() {
        keyboardContainer.innerHTML = '';
        
        layout.forEach(rowKeys => {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'row';

            rowKeys.forEach(key => {
                const btn = document.createElement('div');
                
                // Determine display content
                let displayMain = key;
                let displaySub = '';
                let isSpecial = false;
                
                if (key.length > 1) {
                    isSpecial = true;
                    if(key === 'Backspace') btn.innerHTML = '⌫';
                    else if(key === 'Tab') btn.innerHTML = 'Tab';
                    else if(key === 'Caps') btn.innerHTML = 'Caps';
                    else if(key === 'Enter') btn.innerHTML = '↵';
                    else if(key === 'Shift') btn.innerHTML = '⇧';
                    else if(key === 'Space') btn.innerHTML = ' ';
                    
                    btn.className = `key key-special key-${key.toLowerCase()}`;
                    btn.dataset.code = key; // ID for special keys
                } else {
                    // It's a character key
                    btn.className = 'key';
                    const arabicChar = getChar(key, isShifted || isCaps); // Simple logic: caps acts like shift for visuals here
                    displayMain = arabicChar;
                    displaySub = key.toUpperCase();
                    
                    btn.innerHTML = `<span class="sub">${displaySub}</span><span class="main">${displayMain}</span>`;
                    
                    // Map code for highlighting
                    // Reverse lookup codeToChar is tricky, so we rely on the character
                    // We assign a data attribute matching the QWERTY char
                    btn.dataset.key = key;
                }

                // Mouse Interaction
                btn.addEventListener('mousedown', (e) => {
                    e.preventDefault(); // Prevent focus loss
                    
                    if (isSpecial) {
                        if (key === 'Backspace') handleBackspace();
                        if (key === 'Space') insertAtCursor(' ');
                        if (key === 'Enter') insertAtCursor('\n');
                        if (key === 'Tab') insertAtCursor('\t');
                        if (key === 'Shift') {
                            isShifted = !isShifted;
                            renderKeyboard(); // Re-render to show shifted chars
                        }
                        if (key === 'Caps') {
                            isCaps = !isCaps;
                            renderKeyboard();
                        }
                    } else {
                        // Insert the arabic character displayed
                        insertAtCursor(displayMain);
                        
                        // If shift was active (non-sticky for mouse click usually, but standard behavior varies)
                        if(isShifted) {
                            isShifted = false;
                            renderKeyboard();
                        }
                    }
                });

                rowDiv.appendChild(btn);
            });
            keyboardContainer.appendChild(rowDiv);
        });
        
        // Visual toggle state
        if(isShifted) document.querySelectorAll('.key-shift').forEach(el => el.style.background = '#bbb');
        if(isCaps) document.querySelectorAll('.key-caps').forEach(el => el.style.background = '#bbb');
    }

    // --- Physical Keyboard Events ---

    document.addEventListener('keydown', (e) => {
        // Only intercept if toggle is ON and focus is on textarea
        if (!toggle.checked || document.activeElement !== textarea) return;

        // Allow shortcuts (Ctrl+C, Ctrl+V, etc.)
        if (e.ctrlKey || e.metaKey || e.altKey) return;

        // Get the base char from the code (physical location)
        const baseKey = codeToChar[e.code];

        if (e.key === 'Shift') {
            isShifted = true;
            renderKeyboard();
            return;
        }
        
        if (e.key === 'CapsLock') {
            isCaps = !isCaps; // Toggle
            renderKeyboard();
            return;
        }

        // Highlight visual key
        highlightKey(e.code, true);

        if (baseKey && mappings[baseKey]) {
            e.preventDefault();
            const char = getChar(baseKey, e.shiftKey || isCaps); // Use actual event shift state
            insertAtCursor(char);
        }
    });

    document.addEventListener('keyup', (e) => {
        if (e.key === 'Shift') {
            isShifted = false;
            renderKeyboard();
        }
        highlightKey(e.code, false);
    });

    function highlightKey(code, isActive) {
        // Find button
        let btn;
        const char = codeToChar[code];
        
        if (char) {
            btn = document.querySelector(`.key[data-key="${char}"]`);
        } else {
            // Special keys
            let selectorCode = code;
            if(code === 'Space') selectorCode = 'Space';
            if(code === 'Enter') selectorCode = 'Enter';
            if(code.includes('Shift')) selectorCode = 'Shift';
            if(code === 'Backspace') selectorCode = 'Backspace';
            
            btn = document.querySelector(`.key[data-code="${selectorCode}"]`);
        }

        if (btn) {
            if (isActive) btn.classList.add('active');
            else btn.classList.remove('active');
        }
    }

    // Initial Render
    renderKeyboard();

</script>

</body>
</html>
